# Environment Variables

```ts
// .env for react , var must start with <REACT_APP_>
REACT_APP_API_SERVER=http://localhost:8080
REACT_APP_FACEBOOK_APP_ID=123123123123123

// somewhere in react
  <FacebookLogin
    appId={process.env.REACT_APP_FACEBOOK_APP_ID || ''}
    autoLoad={true}
    fields="name,email,picture"
    onClick={this.componentClicked}
    callback={this.responseFacebook}
  />


// enable https in react
HTTPS=true
```

---

# JSON Web Token

Â a token generated by the server side to identify whether the API client is valid or not 

`HEADER({alg,type}).PAYLOAD(DATA).SIGNITURE(encry)`

### Example using passport-jwt

#### Backend

```cmd
yarn add passport passport-jwt jwt-simple
```

```js
// ./backend/auth.js
const passport = require('passport');
const passportJWT = require('passport-jwt');
const config = require('./config');
const users = require('./users');
const ExtractJwt = passportJWT.ExtractJwt;

module.exports = ()=>{
    const strategy = new passportJWT.Strategy({
        secretOrKey: config.jwtSecret,
        jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken()
    },(payload,done)=>{
        const user = users[payload.id];
        if (user) {
            return done(null, {id: user.id});
        } else {
            return done(new Error("User not found"), null);
        }
    });
    passport.use(strategy);

    return {
        initialize: function() {
            return passport.initialize();
        },
        authenticate: function() {
            return passport.authenticate("jwt", config.jwtSession);
        }
    };
}

// ./backend/config.js
module.exports = {
    jwtSecret: "jsakdlfljadsmview12",
    jwtSession: {
        session: false
    }
}

// ./backend/app.js
const express = require("express");
const app = express();
const bodyParser = require('body-parser');
const cors = require("cors");
app.use(bodyParser.urlencoded({ extended: false }));
app.use(bodyParser.json());
app.use(cors());
const http = require('http').Server(app);
const users = require("./users");
const config = require("./config");

var jwt = require('jwt-simple');

app.get("/", function(req,res) {
    res.send("welcome");
});

app.post("/api/login", (req, res) => {  
    console.log(req.body)
    if (req.body.username && req.body.password) {
        var username = req.body.username;
        var password = req.body.password;
        var user = users.find((u)=> {
            return u.username === username && u.password === password;
        });
        if (user) {
            var payload = {
                id: user.id
            };
            var token = jwt.encode(payload, config.jwtSecret);
            res.json({
                token: token
            });
        } else {
            res.sendStatus(401);
        }
    } else {
        res.sendStatus(400); 
    }
});

http.listen(8080);

// Authorization Header should look like this
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZCI6MH0.uijjNe6mXZkYN6uBSWRpEA_oEtRD17jBlSCgNcCH6sw
```

---

#### Frontend

```ts
// see example
```

